
# SOURCE CODE REVIEW

- `https://political-web.chal.irisc.tf/`  immediately when we access the site a random hex token is generated by `token` end point

```python
@app.route("/token")

def tok():

token = secrets.token_hex(16)

valid_tokens[token] = False

return token
```

here the token that is given is not a valid one because `valid_tokens[token] = False`


- now get pathways for the flag

```python
@app.route("/redeem", methods=["POST"])

def redeem():

if "token" not in request.form:

return "Give me token"

  

token = request.form["token"]

if token not in valid_tokens or valid_tokens[token] != True:

return "Nice try."

  

return FLAG
```

- token must be supplied through args `if "token" not in request.form:`
- then our token must be in valid tokens(line 8) `valid_tokens = {}`
- if this conditions met we will get `FLAG` . else any of the other return hits and come out of the functiom

# INSERT TOKE IN TO VALID_TOKENS
- our main goal is make the token valid ,  `/giveflag` function make this happen

```python
@app.route("/giveflag")

def hello_world():

if "token" not in request.args or "admin" not in request.cookies:

return "Who are you?"

token = request.args["token"]

admin = request.cookies["admin"]

if token not in valid_tokens or admin != ADMIN:

return "Why are you?"

  

valid_tokens[token] = True

return "GG"
```

- here we must provide token as a parameter and admin cookie `if "token" not in request.args or "admin" not in request.cookies:`
- then ,  token must be in valid token or cookie must be admin , `if token not in valid_tokens or admin != ADMIN:` to bypass this conditional if
- if it is done , our token will be in valid token access `/redeem` to get flag , now our aim is to visit with admin cookie , where is it ? 

# GETTING VISITED WIHT ADMIN COOKIE

```js
let cookie = JSON.parse(fs.readFileSync('/home/user/cookie'));
```

- cookie is red frm `/home/user/cookie` which is admin cookie

```json
{

"name": "admin",

"value": "redacted",

"domain": "localhost:5000",

"url": "http://localhost:5000/",

"path": "/",

"httpOnly": true,

"secure": true

}
```

- puppeteer will open a page set this cookie then visit the page we give as input 
- input url must start with `https://political-web.chal.irisc.tf/` and satisfied chrome policies `policy.json` now what is it ? [](https://support.google.com/chrome/a/answer/9942583?hl=en)
- lets construct the url  `https://political-web.chal.irisc.tf/giveflag?token=<generated token via /token>`

- but the above meets the conditions in bot.js but fails by policy.json


